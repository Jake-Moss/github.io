<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-12-24 Tue 14:40 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jake Moss &#x2014; Mono-page</title>
<meta name="author" content="Jake Moss" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel='stylesheet' type='text/css' href='https://latex.now.sh/style.css'/><link rel='stylesheet' type='text/css' href='org-htmlize-style.css'/><link rel='stylesheet' type='text/css' href='style.css'/>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="preamble" class="status">
<h1 class='author'>Jake Moss</h1>
</div>
<div id="content" class="content">
<div class='centred-container'>
<div class='abstract'>
  <h2>About me</h2>
  I'm a Computer Science Honours student at the University of Queensland interested in high performance computing, lisps, and functional programming. I mainly write Cython in Emacs for my day job and am working on computer algebra systems for my thesis. 
</div>
</div>

<p>
This is a mono-page of everything here (although not much). I prefer being able to scroll and search through web pages in their entirety.
</p>

<p>
Here's a list of things on this page
</p>
<div>
<!-- Inline html toc marker --><ul ><li ><a href='#bootstrapping'>The article is the publishing script?</a></li></ul>
</div>

<p>
Pages can be narrowed to by clicking on their respective titles.
</p>

<div>
<!-- Inline html subpage marker --><div class='subpage'><h1 class='subpage-title' id='bootstrapping'><a href='bootstrapping.html'>The article is the publishing script?</a></h1><div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org21a9736">1. So what's so special about this?</a></li>
<li><a href="#org45daab7">2. <code>org-export</code> and <code>org-publish</code></a></li>
<li><a href="#org0be1417">3. What about the so-called publishing script being an article?</a></li>
<li><a href="#orgb129521">4. The meat of it</a>
<ul>
<li><a href="#orga4c0e5a">4.1. Setup, packages, and variables</a></li>
<li><a href="#org74964ce">4.2. Functions</a></li>
<li><a href="#org6a8d3e6">4.3. Wait wait where did those markers come from?</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
I used to have a pretty standard Jekyll theme as this web page. I'd hacked on it a bit and added support for <a href="https://orgmode.org/">Org Mode</a> being the Emacs user I am, but after getting it up and running I promptly lost interest. Will the same thing happen to this page? Yeah probably. Either way, lectures just ended for another semester and I got a spur of motivation to get something going again. Specifically to try out <a href="https://docs.racket-lang.org/pollen/index.html">Pollen</a>. Which describes itself as
</p>
<blockquote>
<p>
[&#x2026;] a publishing system that helps authors make functional and beautiful digital books.
</p>

<p>
At the core of Pollen is an argument:
</p>
<ul class="org-ul">
<li>Digital books should be the best books weve ever had. So far, they're not even close.</li>
<li>Because digital books are software, an author shouldn't think of a book as merely data. The book is a program.</li>
<li>The way we make digital books better than their predecessors is by exploiting this programmability.</li>
</ul>
<p>
&#x2014; Matthew Butterick, Pollen: the book is a program
</p>
</blockquote>

<p>
While it clearly states that it's for digital books, it targets <code>HTML</code> and looked pretty cool so I gave it a shot. If you've seen the bottom of this page you may notice it was created with <code>org-mode</code>, so clearly, the <code>pollen</code> attempt didn't make it. While it's a very cool system, I had issues with the export behaving oddly, paragraph tags were showing up where they shouldn't have and it became difficult to fine-tune the export, despite having immense control of the output with the <a href="https://docs.racket-lang.org/pollen/third-tutorial.html"><code>pollen markup</code></a> format. As a templating system, the <a href="https://docs.racket-lang.org/pollen/first-tutorial.html#(part._.Inserting_variables_within_.C.S.S)"><code>pollen preprocessor</code></a> could be quite nice. I can see being able to inject arbitrary Racket code into anything text-based as something somebody needs for some reason.
</p>

<div id="outline-container-org21a9736" class="outline-2">
<h2 id="org21a9736"><span class="section-number-2">1.</span> So what's so special about this?</h2>
<div class="outline-text-2" id="text-1">
<p>
Well not much. I've used a lot of <code>org-mode</code> in the past and even attempted to do this once before. It's quite a nice markup language, I've personally used it for organising notes, managing TODO lists, planning projects, writing assignments, scheduling, agenda views, tagging, and exporting to various formats. It also supports literate programming, tables, and extensive customisation with Emacs Lisp. The literate programming has been quite useful for assignments that require lots of in-document code and outputs.
</p>

<p>
One thing that <code>org-mode</code> has that I think <code>markdown</code> and other variants lack is the extensibility. Don't get me wrong, there are a ton of tools that can process <code>markdown</code> and spit out something useful that is plenty configurable. But <code>org-mode</code> is first and foremost a part of Emacs. That means it comes with Emac's extensibility, which, in my opinion, is lightyears beyond anything else. And something that I'll talk more about later on this page.
</p>
</div>
</div>

<div id="outline-container-org45daab7" class="outline-2">
<h2 id="org45daab7"><span class="section-number-2">2.</span> <code>org-export</code> and <code>org-publish</code></h2>
<div class="outline-text-2" id="text-2">
<p>
My lecturers certainly aren't interested in reading my assignments in a plain-text markup language almost exclusively supported by a <a href="https://www.gnu.org/software/emacs/">text editor first released in 1985</a>. Fortunately, <code>org-mode</code> has excellent support exporting documents to other formats including <code>HTML</code>, and \(\LaTeX\). On top of this <code>org-publish</code> adds support for processes a set of files, potentiality exporting, and publishing them. These systems are highly configurable and featureful.
</p>

<p>
All pages here (including the mono-page) are generated from a set of <code>.org</code> files, published via the <code>org-html-publish-to-html</code> function, smeared with a little <code>CSS</code> <a href="https://latex.vercel.app">that isn't mine</a>, then thrown up on a <a href="https://github.com/Jake-Moss/github.io">github.io</a> page. All in all it was about an evening's work to learn how the <code>org-publish</code> system worked, experiment, and polish to just what I had in mind.
</p>
</div>
</div>

<div id="outline-container-org0be1417" class="outline-2">
<h2 id="org0be1417"><span class="section-number-2">3.</span> What about the so-called publishing script being an article?</h2>
<div class="outline-text-2" id="text-3">
<p>
Yeah, so this article isn't <i>really</i> the publishing script. Specifically the <code>bootstrappaing.org</code> file is <i>tangled</i> to <code>publish.el</code>, which is then executed. Tangling is the process of extracting source code from a document expanding, merging, and transforming it. Org then recomposes them into one or more separate files.
</p>

<p>
But it didn't use to be like that. To bootstrap the page I wrote a bog-standard <code>.el</code> file that could be loaded and executed from the command line to publish the page during testing,
</p>
<div class="org-src-container">
<pre class="src src-sh">emacs -Q --batch -l publish.el --funcall publish
</pre>
</div>
<p>
During the writing of this article, I'm moving everything into here. Then I'll be able to
</p>
<div class="org-src-container">
<pre class="src src-sh">emacs -Q --batch -l org bootstrapping.org -f org-babel-tangle -l publish.el --eval <span class="org-string">'(org-publish "site")'</span>
</pre>
</div>
<p>
which isn't much of a change to be fair, but it's the principle that matters.
</p>
</div>
</div>

<div id="outline-container-orgb129521" class="outline-2">
<h2 id="orgb129521"><span class="section-number-2">4.</span> The meat of it</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orga4c0e5a" class="outline-3">
<h3 id="orga4c0e5a"><span class="section-number-3">4.1.</span> Setup, packages, and variables</h3>
<div class="outline-text-3" id="text-4-1">
<p>
First, we'll do some house keeping, I don't want these packages in my main <code>init.el</code>, so we'll move the package directory and <code>require</code> the built-in things I'll need.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">base-directory</span> (expand-file-name <span class="org-string">"~/Projects/github.io/"</span>))
(<span class="org-keyword">defvar</span> <span class="org-variable-name">public-directory</span> (file-name-concat base-directory <span class="org-string">"docs"</span>))

(mkdir public-directory t)

(<span class="org-keyword">require</span> '<span class="org-constant">package</span>)
(<span class="org-keyword">setq</span> package-user-dir (file-name-concat base-directory <span class="org-string">".packages"</span>))

(add-to-list 'package-archives '(<span class="org-string">"melpa"</span> . <span class="org-string">"https://melpa.org/packages/"</span>))
(add-to-list 'package-archives '(<span class="org-string">"melpa-stable"</span> . <span class="org-string">"https://stable.melpa.org/packages/"</span>))

(package-initialize)
(<span class="org-keyword">unless</span> package-archive-contents
  (package-refresh-contents))

(<span class="org-keyword">unless</span> (package-installed-p 'use-package)
  (package-install 'use-package))

(<span class="org-keyword">require</span> '<span class="org-constant">use-package</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">ox-publish</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">cl-lib</span>)

(<span class="org-keyword">use-package</span> <span class="org-constant">htmlize</span>
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>

<p>
I use a few custom variables as well. <code>inline-html-publish-index-subpages</code> is a bit interesting, because I wanted to generate a mono-page as well as the individual pages I needed to have a custom publishing function, and I need to store the subpages for addition to the mono-page.
The <code>-marker</code> variables are used to mark where some of the table of contents and subpages should be inserted. It's a bit of a hack I know I know but it works just fine.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">inline-html-publish-index-subpages</span> nil)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">inline-html-publish-toc-marker</span> <span class="org-string">"&lt;!-- Inline html toc marker --&gt;"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">inline-html-publish-subpage-marker</span> <span class="org-string">"&lt;!-- Inline html subpage marker --&gt;"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">inline-html-publish-page-format</span> <span class="org-string">"&lt;h1 class='</span><span class="org-string"><span class="org-constant">subpage-title</span></span><span class="org-string">' id='</span><span class="org-string"><span class="org-constant">%s</span></span><span class="org-string">'&gt;&lt;a href='</span><span class="org-string"><span class="org-constant">%s</span></span><span class="org-string">'&gt;%s&lt;/a&gt;&lt;/h1&gt;"</span>)
</pre>
</div>

<p>
I also need to configure some generic <code>org-html</code> variables.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-html-head-include-default-style t
      org-html-preamble t
      org-html-htmlize-output-type 'css
      org-html-postamble t
      org-html-head (concat
                     <span class="org-string">"&lt;link rel='</span><span class="org-string"><span class="org-constant">stylesheet</span></span><span class="org-string">' type='</span><span class="org-string"><span class="org-constant">text/css</span></span><span class="org-string">' href='</span><span class="org-string"><span class="org-constant">https://latex.now.sh/style.css</span></span><span class="org-string">'/&gt;"</span>
                     <span class="org-string">"&lt;link rel='</span><span class="org-string"><span class="org-constant">stylesheet</span></span><span class="org-string">' type='</span><span class="org-string"><span class="org-constant">text/css</span></span><span class="org-string">' href='</span><span class="org-string"><span class="org-constant">org-htmlize-style.css</span></span><span class="org-string">'/&gt;"</span>
                     <span class="org-string">"&lt;link rel='</span><span class="org-string"><span class="org-constant">stylesheet</span></span><span class="org-string">' type='</span><span class="org-string"><span class="org-constant">text/css</span></span><span class="org-string">' href='</span><span class="org-string"><span class="org-constant">style.css</span></span><span class="org-string">'/&gt;"</span>))
</pre>
</div>

<p>
The real meat of the <code>org-publish</code> system is the <code>org-publish-project-alist</code> variable, it defines what files should be published and how. This is a pretty boring one, we only have
</p>
<ul class="org-ul">
<li><code>"contents":</code> recursively publish any file ending in <code>.org</code> (except <code>index.org</code>) in the <code>base-directory</code> to the <code>public-directory</code> with the <code>org-html-publish-to-html</code> function.</li>
<li><code>"static":</code> just copies some common resources to the <code>public-directory</code>.</li>
<li><code>"index":</code> is a little more interesting. It's very similar to <code>"contents"</code> but use my <code>inline-html-publish-index</code> function to publish the <code>index.org</code> file.</li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-publish-project-alist
      `((<span class="org-string">"contents"</span>
         <span class="org-builtin">:base-directory</span> ,base-directory
         <span class="org-builtin">:base-extension</span> <span class="org-string">"org"</span>
         <span class="org-builtin">:exclude</span> <span class="org-string">"index.org"</span>
         <span class="org-builtin">:publishing-directory</span> ,public-directory
         <span class="org-builtin">:recursive</span> t
         <span class="org-builtin">:publishing-function</span> org-html-publish-to-html
         <span class="org-builtin">:html-postamble</span> ,(concat
                           <span class="org-string">"&lt;p class=\"author\"&gt;%a&lt;/p&gt;"</span>
                           <span class="org-string">"&lt;p class=\"author\"&gt;Date: %T&lt;/p&gt;"</span>
                           <span class="org-string">"&lt;p class=\"author\"&gt;%c&lt;/p&gt;"</span>)
         <span class="org-builtin">:headline-levels</span> 4
         <span class="org-builtin">:auto-preamble</span> t)
        (<span class="org-string">"static"</span>
         <span class="org-builtin">:base-directory</span> ,base-directory
         <span class="org-builtin">:base-extension</span> <span class="org-string">"css</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">js</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">png</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">jpg</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">gif</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">pdf</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">mp3</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">ogg</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">swf"</span>
         <span class="org-builtin">:include</span> (<span class="org-string">"CNAME"</span>)
         <span class="org-builtin">:exclude</span> <span class="org-string">"docs"</span>
         <span class="org-builtin">:publishing-directory</span> ,public-directory
         <span class="org-builtin">:recursive</span> t
         <span class="org-builtin">:publishing-function</span> org-publish-attachment)
        (<span class="org-string">"index"</span>
         <span class="org-builtin">:inline-components</span> (<span class="org-string">"contents"</span>)
         <span class="org-builtin">:inline-plist</span> (<span class="org-builtin">:body-only</span> t <span class="org-builtin">:publishing-function</span> inline-html-publish)
         <span class="org-builtin">:publishing-function</span> inline-html-publish-index
         <span class="org-builtin">:base-directory</span> ,base-directory
         <span class="org-builtin">:base-extension</span> <span class="org-string">"org"</span>
         <span class="org-builtin">:exclude</span> <span class="org-string">".*"</span>
         <span class="org-builtin">:include</span> (<span class="org-string">"index.org"</span>)
         <span class="org-builtin">:publishing-directory</span> ,public-directory
         <span class="org-builtin">:recursive</span> nil
         <span class="org-builtin">:headline-levels</span> 4
         <span class="org-builtin">:auto-preamble</span> t)
        (<span class="org-string">"site"</span> <span class="org-builtin">:components</span> (<span class="org-string">"index"</span> <span class="org-string">"contents"</span> <span class="org-string">"static"</span>))))
</pre>
</div>
<p>
<code>inline-components</code> and <code>inline-plist</code> are my own properties, they're used in <code>inline-html-publish-index</code> to configure the mono-page subpage exports.
</p>
</div>
</div>
<div id="outline-container-org74964ce" class="outline-3">
<h3 id="org74964ce"><span class="section-number-3">4.2.</span> Functions</h3>
<div class="outline-text-3" id="text-4-2">
<p>
I wrote a small helper macro to make writing some <code>HTML</code> tags easier. It's not particularly fancy but it does the job.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defmacro</span> <span class="org-function-name">with-tag</span> (tag attribute-alist <span class="org-type">&amp;rest</span> body)
  <span class="org-doc">"Insert &lt;TAG `</span><span class="org-doc"><span class="org-constant">attributes</span></span><span class="org-doc">'&gt;, execute BODY, then insert &lt;/TAG&gt;.</span>
<span class="org-doc">ATTRIBUTE-ALIST's key-value pairs are converted into HTML attributes."</span>
  (<span class="org-keyword">declare</span> (indent 1) (debug t))
  (<span class="org-keyword">let</span> ((attribute-list (gensym <span class="org-string">"attribute-list"</span>))
        (attributes (gensym <span class="org-string">"attributes"</span>)))
    `(<span class="org-keyword">let*</span> ((,attribute-list (<span class="org-keyword">cl-loop</span> for (prob . val) in ,attribute-alist collect
                                      (concat prob <span class="org-string">"='"</span> val <span class="org-string">"'"</span>)))
            (,attributes (string-join ,attribute-list <span class="org-string">" "</span>)))
       (insert (concat <span class="org-string">"&lt;"</span> ,tag <span class="org-string">" "</span> ,attributes <span class="org-string">"&gt;"</span>))
       ,@body
       (insert (concat <span class="org-string">"&lt;/"</span> ,tag <span class="org-string">"&gt;"</span>)))))
</pre>
</div>

<p>
The previously mentioned <code>inline-html-publish</code> function works by getting the to-be-published file and exporting it as <code>HTML</code> into a temp buffer, adding some <code>HTML</code> to the top via a format string, then plopping that plus some metadata into the <code>inline-html-publish-index-subpages</code> variable.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">inline-html-publish</span> (plist filename pub-dir)
  <span class="org-doc">"Publish FILENAME into `</span><span class="org-doc"><span class="org-constant">inline-html-publish-index-subpages</span></span><span class="org-doc">'.</span>
<span class="org-doc">Stored as (timestamp output-filename title html-string).  Update the</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:inline-components</span></span><span class="org-doc">' in PLIST with `</span><span class="org-doc"><span class="org-constant">:inline-plist</span></span><span class="org-doc">'.  PUB-DIR is</span>
<span class="org-doc">ignored."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((org-inhibit-startup t)
         (visiting (find-buffer-visiting filename))
         (work-buffer (<span class="org-keyword">or</span> visiting (find-file-noselect filename)))
         (output-filename (org-publish-file-relative-name
                           (file-name-with-extension filename <span class="org-string">".html"</span>)
                           plist))
         (temp-buffer (generate-new-buffer <span class="org-string">" *temp*"</span> t))
         (title nil))
    (<span class="org-keyword">with-current-buffer</span> work-buffer
      (<span class="org-keyword">setq</span> title (org-get-title))
      (org-export-to-buffer 'html temp-buffer nil nil nil t))

    (<span class="org-keyword">with-current-buffer</span> temp-buffer
      (<span class="org-keyword">when</span> title
        (insert (format inline-html-publish-page-format
                        (file-name-sans-extension output-filename)
                        output-filename
                        title)))
      (<span class="org-keyword">push</span> `(,(org-publish-cache-mtime-of-src filename)
              ,output-filename
              ,title
              ,(buffer-string))
            inline-html-publish-index-subpages))

    (kill-buffer temp-buffer)
    (<span class="org-keyword">unless</span> visiting (kill-buffer work-buffer))))
</pre>
</div>

<p>
To the "publish" the <code>index.org</code> file it uses my <code>inline-html-publish-index</code> function. It first merges the properties for the components from <code>:inline-components</code> with <code>:inline-plist</code> and does some other setup-related tasks. Then publishes the <code>index.org</code> file to the <code>html-buffer</code> buffer, followed up publishing the <code>:inline-components</code> with the now updated project alist.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">inline-html-publish-index</span> (plist filename pub-dir)
  <span class="org-doc">"Build a mono-page from FILENAME and `</span><span class="org-doc"><span class="org-constant">inline-html-publish-index-subpages</span></span><span class="org-doc">'.</span>
<span class="org-doc">Merges the `</span><span class="org-doc"><span class="org-constant">:inline-plist</span></span><span class="org-doc">' with the plist of `</span><span class="org-doc"><span class="org-constant">:inline-components</span></span><span class="org-doc">' in PLIST"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((org-inhibit-startup t)
         (org-html-preamble-format `((<span class="org-string">"en"</span> <span class="org-string">"&lt;h1 class='</span><span class="org-string"><span class="org-constant">author</span></span><span class="org-string">'&gt;%a&lt;/h1&gt;"</span>)))
         (org-html-postamble-format `((<span class="org-string">"en"</span> ,(concat
                                              <span class="org-string">"&lt;p class=\"author\"&gt;Date: %T&lt;/p&gt;"</span>
                                              <span class="org-string">"&lt;p class=\"author\"&gt;%c&lt;/p&gt;"</span>))))
         (visiting (find-buffer-visiting filename))
         (work-buffer (<span class="org-keyword">or</span> visiting (find-file-noselect filename)))
         (output-filename (file-name-concat
                           pub-dir
                           (file-name-with-extension
                            (org-publish-file-relative-name filename plist)
                            <span class="org-string">".html"</span>)))
         (html-buffer (find-file-noselect output-filename nil t))
         (inline-plist (plist-get plist <span class="org-builtin">:inline-plist</span>))
         (inline-projects (<span class="org-keyword">cl-loop</span>
                           for component in (plist-get plist <span class="org-builtin">:inline-components</span>)
                           collect
                           (<span class="org-keyword">let*</span> ((project (assoc component org-publish-project-alist))
                                  (project-name (car project))
                                  (project-plist (cdr project)))
                             (cons project-name (append inline-plist project-plist))))))
    (<span class="org-keyword">with-current-buffer</span> work-buffer
      (org-export-to-buffer 'html html-buffer nil nil nil nil))

    (<span class="org-keyword">let</span> ((org-publish-use-timestamps-flag nil))
      (org-publish-projects inline-projects))

    (<span class="org-keyword">setq</span> inline-html-publish-index-subpages
          (mapcar #'cdr
                  (sort inline-html-publish-index-subpages
                        #'(<span class="org-keyword">lambda</span> (x y) (not (time-less-p (car x) (car y)))))))

    (<span class="org-keyword">with-current-buffer</span> html-buffer
      (goto-char (point-min))
      (search-forward inline-html-publish-toc-marker)
      (<span class="org-keyword">with-tag</span> <span class="org-string">"ul"</span> nil
                (<span class="org-keyword">cl-loop</span> for (html-filename title html) in inline-html-publish-index-subpages do
                         (<span class="org-keyword">with-tag</span> <span class="org-string">"li"</span> nil
                                   (<span class="org-keyword">with-tag</span> <span class="org-string">"a"</span> `((<span class="org-string">"href"</span> . ,(concat <span class="org-string">"#"</span> (file-name-sans-extension html-filename))))
                                             (insert title)))))

      (goto-char (point-min))
      (search-forward inline-html-publish-subpage-marker)
      (<span class="org-keyword">cl-loop</span> for (html-filename title html) in inline-html-publish-index-subpages do
               (<span class="org-keyword">with-tag</span> <span class="org-string">"div"</span> '((<span class="org-string">"class"</span> . <span class="org-string">"subpage"</span>))
                         (insert html)))
      (save-buffer))

    (kill-buffer html-buffer)
    (<span class="org-keyword">unless</span> visiting (kill-buffer work-buffer))))
</pre>
</div>
<p>
The <code>:inline-components</code> uses the <code>inline-html-publish</code> function which populates the <code>inline-html-publish-index-subpages</code> variable. That's sorted and the timestamps tripped out. It then finds the markers within the html buffer and inserts the relevant content.
</p>

<p>
And that's it.
</p>
</div>
</div>

<div id="outline-container-org6a8d3e6" class="outline-3">
<h3 id="org6a8d3e6"><span class="section-number-3">4.3.</span> Wait wait where did those markers come from?</h3>
<div class="outline-text-3" id="text-4-3">
<p>
They're just embedded as exported <code>HTML</code> blocks in the <code>index.org</code> file. Here's what that looks like
</p>
<div class="org-src-container">
<pre class="src src-org"><span class="org-org-meta-line">#+OPTIONS: title:nil</span>
<span class="org-org-document-info-keyword">#+title:</span><span class="org-org-document-title">Jake Moss --- Mono-page</span>

<span class="org-org-block-begin-line">#+begin_export html</span>
<span class="org-org-block">&lt;</span><span class="org-org-block"><span class="org-function-name">div</span></span><span class="org-org-block"> </span><span class="org-org-block"><span class="org-variable-name">class</span></span><span class="org-org-block">=</span><span class="org-org-block"><span class="org-string">'centred-container'</span></span><span class="org-org-block">&gt;</span>
<span class="org-org-block">&lt;</span><span class="org-org-block"><span class="org-function-name">div</span></span><span class="org-org-block"> </span><span class="org-org-block"><span class="org-variable-name">class</span></span><span class="org-org-block">=</span><span class="org-org-block"><span class="org-string">'abstract'</span></span><span class="org-org-block">&gt;</span>
<span class="org-org-block">  &lt;</span><span class="org-org-block"><span class="org-function-name">h2</span></span><span class="org-org-block">&gt;</span><span class="org-org-block"><span class="org-underline"><span class="org-bold-italic">About me</span></span></span><span class="org-org-block">&lt;/</span><span class="org-org-block"><span class="org-function-name">h2</span></span><span class="org-org-block">&gt;</span>
<span class="org-org-block">  I'm a Computer Science Honours student at the University of Queensland interested in high performance computing, lisps, and functional programming. I mainly write Cython in Emacs for my day job and am working on computer algebra systems for my thesis. </span>
<span class="org-org-block">&lt;/</span><span class="org-org-block"><span class="org-function-name">div</span></span><span class="org-org-block">&gt;</span>
<span class="org-org-block">&lt;/</span><span class="org-org-block"><span class="org-function-name">div</span></span><span class="org-org-block">&gt;</span>
<span class="org-org-block-end-line">#+end_export</span>

This is a mono-page of everything here (although not much). I prefer being able to scroll and search through web pages in their entirety.

Here's a list of things on this page
<span class="org-org-block-begin-line">#+begin_src emacs-lisp :exports results :results value html</span>
<span class="org-org-block">  (string-join `(</span><span class="org-org-block"><span class="org-string">"&lt;div&gt;"</span></span><span class="org-org-block"> ,inline-html-publish-toc-marker </span><span class="org-org-block"><span class="org-string">"&lt;/div&gt;"</span></span><span class="org-org-block">) </span><span class="org-org-block"><span class="org-string">"\n"</span></span><span class="org-org-block">)</span>
<span class="org-org-block-end-line">#+end_src</span>

<span class="org-org-meta-line">#+RESULTS:</span>
<span class="org-org-block-begin-line">#+begin_export html</span>
<span class="org-org-block">&lt;</span><span class="org-org-block"><span class="org-function-name">div</span></span><span class="org-org-block">&gt;</span>
<span class="org-org-block"><span class="org-comment-delimiter">&lt;!-- </span></span><span class="org-org-block"><span class="org-comment">Inline html toc marker</span></span><span class="org-org-block"><span class="org-comment-delimiter"> --&gt;</span></span>
<span class="org-org-block">&lt;/</span><span class="org-org-block"><span class="org-function-name">div</span></span><span class="org-org-block">&gt;</span>
<span class="org-org-block-end-line">#+end_export</span>

Pages can be narrowed to by clicking on their respective titles.

<span class="org-org-block-begin-line">#+begin_src emacs-lisp :exports results :results value html</span>
<span class="org-org-block">  (string-join `(</span><span class="org-org-block"><span class="org-string">"&lt;div&gt;"</span></span><span class="org-org-block"> ,inline-html-publish-subpage-marker </span><span class="org-org-block"><span class="org-string">"&lt;/div&gt;"</span></span><span class="org-org-block">) </span><span class="org-org-block"><span class="org-string">"\n"</span></span><span class="org-org-block">)</span>
<span class="org-org-block-end-line">#+end_src</span>

<span class="org-org-meta-line">#+RESULTS:</span>
<span class="org-org-block-begin-line">#+begin_export html</span>
<span class="org-org-block">&lt;</span><span class="org-org-block"><span class="org-function-name">div</span></span><span class="org-org-block">&gt;</span>
<span class="org-org-block"><span class="org-comment-delimiter">&lt;!-- </span></span><span class="org-org-block"><span class="org-comment">Inline html subpage marker</span></span><span class="org-org-block"><span class="org-comment-delimiter"> --&gt;</span></span>
<span class="org-org-block">&lt;/</span><span class="org-org-block"><span class="org-function-name">div</span></span><span class="org-org-block">&gt;</span>
<span class="org-org-block-end-line">#+end_export</span>

Some things in <span class="org-org-verbatim">=org-publish=</span> are just hard coded and you cannot configure them, one such thing is the detection of $\LaTeX$ fragments to determine if the <span class="org-org-verbatim">=mathjax=</span> scripts should be included. Because I'm inserting the subpages myself the <span class="org-org-verbatim">=mathjax=</span> scripts in them don't apply. So there's one down here to make sure they work on the mono-page.
</pre>
</div>
</div>
</div>
</div>
</div>
</div>

<p>
Some things in <code>org-publish</code> are just hard coded and you cannot configure them, one such thing is the detection of \(\LaTeX\) fragments to determine if the <code>mathjax</code> scripts should be included. Because I'm inserting the subpages myself the <code>mathjax</code> scripts in them don't apply. So there's one down here to make sure they work on the mono-page.
</p>
</div>
<div id="postamble" class="status">
<p class="author">Date: 2024-12-24 Tue 14:40</p><p class="author"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.4 (<a href="https://orgmode.org">Org</a> mode 9.6.15)</p>
</div>
</body>
</html>